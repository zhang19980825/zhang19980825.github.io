
<!DOCTYPE html>
<html lang="zh-Hans" class="loading">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>认真的人，自带光芒。</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="ZhangYang,"> 
    <meta name="description" content="zookeeper集群和solr集群的安装整合：最终实现下面的效果为了节省服务器资源，我把每一台服务器都装了一个zookeeper服务器和solr服务器
一.zookeeper集群搭建1.下载  解,"> 
    <meta name="author" content="ZhangYang"> 
    <link rel="alternative" href="atom.xml" title="认真的人，自带光芒。" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
</head></html>
<body class="loading">
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">solr及es的安装</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>
    <div class="section">
        <div class="article">
    <div class="main">
        <h1 class="title">solr及es的安装</h1>
        <div class="stuff">
            <span>五月 20, 2019</span>
            

        </div>
        <div class="content markdown">
            <h2 id="zookeeper集群和solr集群的安装整合："><a href="#zookeeper集群和solr集群的安装整合：" class="headerlink" title="zookeeper集群和solr集群的安装整合："></a>zookeeper集群和solr集群的安装整合：</h2><p>最终实现下面的效果<br><img src="http://kan.027cgb.com/613363/2019051601.jpg" alt="avator"><br>为了节省服务器资源，我把每一台服务器都装了一个zookeeper服务器和solr服务器</p>
<h3 id="一-zookeeper集群搭建"><a href="#一-zookeeper集群搭建" class="headerlink" title="一.zookeeper集群搭建"></a>一.zookeeper集群搭建</h3><p>1.下载  解压缩   重命名<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirror.bit.edu.cn/apache/zookeeper/zookeeper-3.4.10/zookeeper-3.4.10.tar.gz</span><br><span class="line"></span><br><span class="line">tar –zxf zookeeper-3.4.10.tar.gz</span><br><span class="line"></span><br><span class="line">mv zookeeper-3.4.10 zk</span><br></pre></td></tr></table></figure></p>
<p>2.创建zoo.cfg<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd zk/conf</span><br><span class="line"></span><br><span class="line">mv zoo_sample.cfg zoo.cfg</span><br></pre></td></tr></table></figure></p>
<p>3.修改zoo.cfg，进行zookeeper集群配置<br>vim zoo.cfg<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">修改内容如下:</span><br><span class="line">dataDir=/kkb/soft/zk/data</span><br><span class="line"># the port at which the clients will connect</span><br><span class="line">clientPort=2181</span><br><span class="line">#集群中每台机器都是以下配置</span><br><span class="line">#2881系列端口是zookeeper通信端口</span><br><span class="line">#3881系列端口是zookeeper投票选举端口</span><br><span class="line">server.1=192.168.96.151:2881:3881</span><br><span class="line">server.2=192.168.96.152:2881:3881</span><br><span class="line">server.3=192.168.96.153:2881:3881</span><br></pre></td></tr></table></figure></p>
<p>4.在dataDir目录下创建myid文件，文件内容为1，对应server.1中的1。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">添加内容如下（其他的zookeeper分别设置为 2和3 ）：</span><br><span class="line">1</span><br></pre></td></tr></table></figure></p>
<p>5.启动zookeeper服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/kkb/soft/zk/bin/zkServer.sh start</span><br></pre></td></tr></table></figure></p>
<p>6.查看zookeeper状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/kkb/soft/zk/bin/zkServer.sh status</span><br></pre></td></tr></table></figure></p>
<p>其余两个服务器同理。。</p>
<h3 id="二-solrCloud集群搭建"><a href="#二-solrCloud集群搭建" class="headerlink" title="二.solrCloud集群搭建"></a>二.solrCloud集群搭建</h3><h4 id="单个solr服务器的安装"><a href="#单个solr服务器的安装" class="headerlink" title="单个solr服务器的安装"></a>单个solr服务器的安装</h4><p>下载  解压缩<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://archive.apache.org/dist/lucene/solr/4.10.4/solr-4.10.4.tgz</span><br><span class="line"></span><br><span class="line">tar -xf solr-4.10.4.tgz</span><br></pre></td></tr></table></figure></p>
<p>启动方法一：Solr默认提供Jetty（java写的Servlet容器）启动solr服务器。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">进入example目录</span><br><span class="line"></span><br><span class="line">执行命令：java -jar start.jar</span><br><span class="line"></span><br><span class="line">访问地址：http://192.168.96.151:8983/solr</span><br></pre></td></tr></table></figure></p>
<p>启动方法二：手动使用Tomcat部署<br>1.安装Tomcat  解压<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rz</span><br><span class="line"></span><br><span class="line">tar -zxvf apache-tomcat-x.xx.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>2.部署solr.war<br>把solr安装目录的webapp里面的solr.war拷贝到tomcat安装目录里面的webapp里面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /software/solr-4.10.4/example/webappssolr.war /kkb/server/solr/tomcat-solr/webapps</span><br></pre></td></tr></table></figure></p>
<p>3.解压缩solr.war<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/kkb/server/solr/tomcat-solr/bin/startup.sh</span><br></pre></td></tr></table></figure></p>
<p>4.添加solr扩展jar包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /software/solr-4.10.4/example/ext/*  /kkb/server/solr/tomcat-solr/webapps/solr/WEB-INF/lib/</span><br></pre></td></tr></table></figure></p>
<p>5.添加log4j文件  classes目录需提前创建<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /software/solr-4.10.4/example/resources/log4j/properties /kkb/server/solr/tomcat-solr/webapps/solr/WEB-INF/classes/</span><br></pre></td></tr></table></figure></p>
<p>6.配置solrhome路径<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /kkb/server/solr/tomcat-solr/webapps/solr/WEB-INF/web.xml</span><br><span class="line">修改内容如下：</span><br><span class="line"></span><br><span class="line"> &lt;env-entry&gt;</span><br><span class="line">       &lt;env-entry-name&gt;solr/home&lt;/env-entry-name&gt;</span><br><span class="line">       &lt;env-entry-valu&gt;/kkb/server/solr/solrhome/&lt;/env-entry-valu&gt;</span><br><span class="line">       &lt;env-entry-type&gt;java.lang.String&lt;/env-entry-type&gt;</span><br><span class="line">&lt;/env-entry&gt;</span><br></pre></td></tr></table></figure></p>
<p>7.添加solr中文分词器   需提前上传这些文件<br>(1).把 IKAnalyzer2012FF_u1.jar 添加到</p>
<pre><code>kkb/server/solr/tomcat-solr/webapps/solr/WEB-INF/lib目录下。
</code></pre><p>(2).复制IKAnalyzer的配置文件和自定义词典和停用词词典到solr的classes目录下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp /root/IK\ Analyzer\ 2012FF_hf1/IKAnalyzer.cfg.xml /kkb/server/solr/tomcat-solr/webapps/solr/WEB-INF/classes/</span><br><span class="line"></span><br><span class="line">cp /root/IK\ Analyzer\ 2012FF_hf1/ext.dic /kkb/server/solr/tomcat-solr/webapps/solr/WEB-INF/classes/</span><br><span class="line"></span><br><span class="line">cp /root/IK\ Analyzer\ 2012FF_hf1/stopword.dic /kkb/server/solr/tomcat-solr/webapps/solr/WEB-INF/classes/</span><br></pre></td></tr></table></figure></p>
<p>(3)在 schema.xml 中添加一个自定义的 fieldType ，使用中文分析器。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;fieldType name=&quot;text_ik&quot; class=&quot;solr.TextField&quot;&gt;</span><br><span class="line">     &lt;analyzer class=&quot;org.wltea.analyzer.lucene.IKAnalyzer&quot;/&gt;</span><br><span class="line">&lt;/fieldType&gt;</span><br></pre></td></tr></table></figure></p>
<p>8.启动Tomcat<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/kkb/server/solr/tomcat-solr/bin/startup.sh</span><br></pre></td></tr></table></figure></p>
<p>9.启动之后我习惯看下日志<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -100f /kkb/server/solr/tomcat-solr/logs/catlina.out</span><br></pre></td></tr></table></figure></p>
<h4 id="solrcloud服务器的安装"><a href="#solrcloud服务器的安装" class="headerlink" title="solrcloud服务器的安装"></a>solrcloud服务器的安装</h4><p>1.Tomcat部署Solr服务<br>复制单机版Solr服务对应的Tomcat，并修改端口为8888（如果不冲突可以不修改端口） 这里的复制是为了给其他两台服务器进行复制的副本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /kkb/server/solr/tomcat-solr /kkb/server/solrcloud/tomcat-8888 -r</span><br><span class="line">vim /kkb/server/solrcloud/tomcat-8888/conf/server.xml</span><br></pre></td></tr></table></figure></p>
<p>修改三个端口： 8005、8009、8080</p>
<p>2.修改Tomcat中的web.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /kkb/server/solrcloud/tomcat-8888/webapps/solr/WEB-INF/web.xml</span><br><span class="line">修改内容如下：</span><br><span class="line">&lt;env-entry&gt;</span><br><span class="line">   &lt;env-entry-name&gt;solr/home&lt;/env-entry-name&gt;</span><br><span class="line">   &lt;env-entry-value&gt;/kkb/server/solrcloud/solrhome8888/&lt;/env-entry-value&gt;</span><br><span class="line">   &lt;env-entry-type&gt;java.lang.String&lt;/env-entry-type&gt;</span><br><span class="line">&lt;/env-entry&gt;</span><br></pre></td></tr></table></figure></p>
<p>3.设置Tomcat的启动参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /kkb/server/solrcloud/tomcat-8888/bin/catalina.sh</span><br><span class="line">在234行下面添加如下内容：</span><br><span class="line">JAVA_OPTS=&quot;-DzkHost=192.168.96.151:2181,192.168.96.152:2181,192.168.96.153:2181&quot;</span><br></pre></td></tr></table></figure></p>
<p>4.复制Tomcat到其他机器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r /kkb/server/solrcloud/tomcat-8888 root@192.168.96.152:/kkb/server/solrcloud/</span><br></pre></td></tr></table></figure></p>
<p>5.创建solrhome<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /kkb/server/solr/solrhome /kkb/server/solrcloud/solrhome8888 -r</span><br></pre></td></tr></table></figure></p>
<p>6.修改solrhome下的solr.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /kkb/server/solrcloud/solrhome8888/solr.xml</span><br><span class="line">修改内容如下（hostPort参数的值）：</span><br><span class="line">&lt;solrcloud&gt;</span><br><span class="line">       &lt;str name=&quot;host&quot;&gt;$&#123;host:&#125;&lt;/str&gt;</span><br><span class="line">       &lt;int name=&quot;hostPort&quot;&gt;8888&lt;/int&gt;</span><br><span class="line">       &lt;str name=&quot;hostContext&quot;&gt;$&#123;hostContext:solr&#125;&lt;/str&gt;</span><br><span class="line">       &lt;int name=&quot;zkClientTimeout&quot;&gt;$&#123;zkClientTimeout:30000&#125;&lt;/int&gt;</span><br><span class="line">       &lt;bool name=&quot;genericCoreNodeNames&quot;&gt;$&#123;genericCoreNodeNames:true&#125;  &lt;/bool&gt;</span><br><span class="line">&lt;/solrcloud&gt;</span><br></pre></td></tr></table></figure></p>
<p>7.复制solrhome到其他机器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r /kkb/server/solrcloud/solrhome8888 root@192.168.96.152:/kkb/server/solrcloud/</span><br></pre></td></tr></table></figure></p>
<p>8.将solr配置文件上传到zookeeper<br>只需要一台机器进行操作即可！！！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">使用 /kkb/soft/solr-4.10.4/example/scripts/cloud-scripts 下的 zkcli.sh 命令</span><br><span class="line">将 /kkb/server/solrcloud/solrhome8888/collection1/conf 目录上传到 zookeeper 进行配置。</span><br><span class="line"></span><br><span class="line">./zkcli.sh -zkhost 192.168.10.135:2181,192.168.10.136:2181,192.168.10.137:2181 -cmd</span><br><span class="line">upconfig -confdir /kkb/server/solrcloud/solrhome8888/collection1/conf -confname</span><br><span class="line">myconf</span><br><span class="line"></span><br><span class="line">使用 zookeeper 自带的 zkCli.sh 命令连接 zookeeper 集群，查看上传的配置文件</span><br><span class="line"></span><br><span class="line">./zkCli.sh -server localhost:2181</span><br></pre></td></tr></table></figure></p>
<p>9.启动所有Tomcat<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/kkb/server/solr/tomcat-solr/bin/startup.sh</span><br></pre></td></tr></table></figure></p>
<p>solr服务器的拷贝同理。。。<br>10.启动效果如图</p>
<h3 id="三-集群分片"><a href="#三-集群分片" class="headerlink" title="三.集群分片"></a>三.集群分片</h3><p>原先有的collection1效果如图：<br><img src="http://kan.027cgb.com/613363/2019051602.jpg" alt="avator"><br>1.创建新的集群，名称为collection2，集群中有三个solr节点，将集群分为三片，每片一个副本。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.96.151:8888/solr/admin/collections?action=CREATE&amp;name=collection2&amp;numShards=3&amp;replicationFactor=1</span><br></pre></td></tr></table></figure></p>
<p>效果如图：<br><img src="http://kan.027cgb.com/613363/2019051603.jpg" alt="avator"></p>
<p>2.删除名称为collection1的集群<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.10.139:8280/solr/admin/collections?action=DELETE&amp;name=collection1</span><br></pre></td></tr></table></figure></p>
<h2 id="es单机及es集群及插件的安装"><a href="#es单机及es集群及插件的安装" class="headerlink" title="es单机及es集群及插件的安装"></a>es单机及es集群及插件的安装</h2><p>安装的时候需要es和Kibana和es中文分词器的安装版本的一致，可在下面链接下载：<br><a href="http://kan.027cgb.com/613363/es%E8%BD%AF%E4%BB%B6.zip" target="_blank" rel="noopener">http://kan.027cgb.com/613363/es%E8%BD%AF%E4%BB%B6.zip</a></p>
<h3 id="一-es的安装-前提条件：jdk不要装在root目录下面"><a href="#一-es的安装-前提条件：jdk不要装在root目录下面" class="headerlink" title="一.es的安装(前提条件：jdk不要装在root目录下面)"></a>一.es的安装(前提条件：jdk不要装在root目录下面)</h3><p>1.下载安装包，解压缩<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-</span><br><span class="line">6.5.3.tar.gz</span><br><span class="line"></span><br><span class="line">tar -xf elasticsearch-6.5.3.tar.gz -C /kkb/server</span><br></pre></td></tr></table></figure></p>
<p>2.配置远程访问<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /kkb/server/elasticsearch-6.5.1/config/elasticsearch.yml</span><br><span class="line"></span><br><span class="line">修改内容如下：</span><br><span class="line">network.host: 0.0.0.0</span><br></pre></td></tr></table></figure></p>
<p>3.配置进程可以拥有的VMA(虚拟内存区域)的数量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line">添加如下内容：</span><br><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></table></figure></p>
<p>4.生效配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure></p>
<p>5.创建启动es的用户并修改允许打开的最大文件描述符数量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">groupadd esgroup</span><br><span class="line">useradd esuser -g esgroup -p 111111</span><br><span class="line"></span><br><span class="line">vim /etc/security/limits.conf</span><br><span class="line">添加如下内容：</span><br><span class="line">esuser soft nofile 65536</span><br><span class="line">esuser hard nofile 65536</span><br><span class="line">esuser soft nproc 4096</span><br><span class="line">esuser hard nproc 4096</span><br></pre></td></tr></table></figure></p>
<p>6.设置用户最大线程数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">修改内容如下：将* 改为具体的es的启动用户</span><br><span class="line">esuser soft nproc 4096</span><br><span class="line">root soft nproc unlimited</span><br></pre></td></tr></table></figure></p>
<p>7.更改 elasticsearch 文件夹及内部文件的所属用户及组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R esuser:esgroup /kkb/server/elasticsearch-6.5.1</span><br></pre></td></tr></table></figure></p>
<p>8.根据服务器内存大小最好先修改一下 jvm.options<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /kkb/server/elasticsearch-6.5.3/config/jvm.options</span><br><span class="line">修改内容如下：</span><br><span class="line">-Xms256m</span><br><span class="line">-Xmx256m</span><br></pre></td></tr></table></figure></p>
<p>9.切换用户并启动es<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su esuser</span><br><span class="line">后端进程启动：/kkb/server/elas ticsearch-6.5.3/bin/elasticsearch -d</span><br></pre></td></tr></table></figure></p>
<p>10.访问：<a href="http://192.168.96.154:9200/" target="_blank" rel="noopener">http://192.168.96.154:9200/</a></p>
<h3 id="一-es插件head的安装"><a href="#一-es插件head的安装" class="headerlink" title="一.es插件head的安装"></a>一.es插件head的安装</h3><p>1.下载安装包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y git</span><br><span class="line">git clone git://github.com/mobz/elasticsearch-head.git</span><br></pre></td></tr></table></figure></p>
<p>2.node.js 下载解压<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://nodejs.org/dist/v10.14.2/node-v10.14.2-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line">tar -xvf node-v10.14.2-linux-x64.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>3.配置环境变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line">export NODE_HOME=/kkb/server/node-v10.14.2-linux-x64</span><br><span class="line">export PATH=$PATH:$NODE_HOME/bin</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure></p>
<p>4.grunt 下载.解压.安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://nodejs.org/dist/npm/npm-1.4.12.tgz</span><br><span class="line">tar -xf npm-1.4.12.tgz</span><br><span class="line">cd npm</span><br><span class="line">./configurer</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></p>
<p>5.安装grunt-cli<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g grunt -cli</span><br><span class="line">进入Elasticsearch-head目录：</span><br><span class="line">npm install grunt --save-dev</span><br></pre></td></tr></table></figure></p>
<p>6.验证<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grunt -version</span><br></pre></td></tr></table></figure></p>
<p>7.head配置文件修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim Elasticsearch-head/Gruntfile.js</span><br><span class="line">修改内容如下：</span><br><span class="line">connect: &#123;</span><br><span class="line">            server: &#123;</span><br><span class="line">                  options: &#123;</span><br><span class="line">                        port: 9100,</span><br><span class="line">                        base: &apos;.&apos;,</span><br><span class="line">                        keepalive: true,</span><br><span class="line">                        hostname: &apos;*&apos;</span><br><span class="line">                              &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure></p>
<p>8.修改Elasticsearch-head/_site/app.js文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">修改这一行加入es服务器的地址：</span><br><span class="line"> this.base_uri = this.config.base_uri || this.prefs.get(&quot;app-base_uri&quot;) || &quot;http://192.168.96.154:9200&quot;;</span><br></pre></td></tr></table></figure></p>
<p>9.启动head插件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup grunt server &amp;</span><br></pre></td></tr></table></figure></p>
<p>10.访问：<a href="http://192.168.96.155:9100/" target="_blank" rel="noopener">http://192.168.96.155:9100/</a></p>
<h3 id="安装中文分词器IK"><a href="#安装中文分词器IK" class="headerlink" title="安装中文分词器IK"></a>安装中文分词器IK</h3><p>1.下载安装包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/medcl/elasticsearch-analysisik/releases/download/v6.5.3/elasticsearch-analysis-ik-6.5.3.zip</span><br></pre></td></tr></table></figure></p>
<p>2.解压<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y unzip</span><br><span class="line"></span><br><span class="line"> 解压到/kkb/server/elasticsearch-6.5.3/plugins/ik 目录</span><br></pre></td></tr></table></figure></p>
<p>3.重新启动es</p>
<h3 id="Kibana安装"><a href="#Kibana安装" class="headerlink" title="Kibana安装"></a>Kibana安装</h3><p>1.下载 解压缩<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/kibana/kibana-6.5.1-linuxx86_64.tar.gz</span><br><span class="line"></span><br><span class="line">tar -xf kibana-6.5.1-linux-x86_64.tar.gz -C /kkb/server/</span><br></pre></td></tr></table></figure></p>
<p>2.编辑 kibana.yml 文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /kkb/server/kibana-6.5.1-linux-x86_64/config/kibana.yml</span><br><span class="line">将 server.host、elasticsearch.url 修改成所在服务器的ip地址:</span><br><span class="line">server.host: &quot;192.168.96.155&quot;</span><br><span class="line">elasticsearch.url: &quot;http://192.168.96.155:9200&quot;</span><br></pre></td></tr></table></figure></p>
<p>3.启动Kibana<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup /kkb/server/kibana-6.5.1-linux-x86_64/bin/kibana &amp;</span><br></pre></td></tr></table></figure></p>
<p>4.通过浏览器访问 Kibana:<a href="http://192.168.96.155:5601" target="_blank" rel="noopener">http://192.168.96.155:5601</a></p>
<h3 id="es集群相关配置"><a href="#es集群相关配置" class="headerlink" title="es集群相关配置"></a>es集群相关配置</h3><p>修改每个节点的 elasticsearch.yml ：<br>vim /kkb/server/elasticsearch-6.5.3/config/elasticsearch.yml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 集群名称要唯一</span><br><span class="line">cluster.name: zhangyang-es</span><br><span class="line"># 集群节点要不同</span><br><span class="line">node.name: node-135</span><br><span class="line"># 设置master和data节点</span><br><span class="line">node.master: true</span><br><span class="line">node.data: true</span><br><span class="line"># 节点将绑定到此主机名或IP地址，我们设置成0.0.0.0为当前主机，允许ip映射访问</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line"># http访问端口</span><br><span class="line">http.port: 9200</span><br><span class="line"># tcp访问端口</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line"># 自动发现的路由节点</span><br><span class="line">discovery.zen.ping.unicast.hosts:</span><br><span class="line">[&quot;192.168.96.154:9300&quot;,&quot;192.168.96.155:9300&quot;]</span><br><span class="line"># 集群中最小主节点数，防止脑裂</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br><span class="line"># head 跨域访问</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-orig</span><br></pre></td></tr></table></figure></p>
<p>网上收集的elasticsearch.yml配置文件的解释：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># 集群名称 Use a descriptive name for your cluster:</span><br><span class="line">cluster.name: kkb-es</span><br><span class="line"># ------------------------------------ Node ------------------------------------</span><br><span class="line"># 节点名称 Use a descriptive name for the node:</span><br><span class="line">node.name: node-135</span><br><span class="line"># 既可以选举为主节点,也可以存储数据,也可作为负载器</span><br><span class="line">node.master: true</span><br><span class="line">node.data: true</span><br><span class="line"># 指定节点的部落属性Add custom attributes to the node:</span><br><span class="line">#node.attr.rack: r1</span><br><span class="line"># ----------------------------------- Paths ------------------------------------</span><br><span class="line"># 数据存储地址 Path to directory where to store the data (separate multiple locations</span><br><span class="line">by comma):</span><br><span class="line">path.data: /opt/apps/elasticsearch/data</span><br><span class="line"># Log日志 Path to log files:</span><br><span class="line">path.logs: /opt/apps/elasticsearch/logs</span><br><span class="line"># 临时文件</span><br><span class="line"># path.work: /opt/apps/elasticsearch/tmp</span><br><span class="line"># 设置插件的存放路径，默认是es根目录下的plugins文件夹</span><br><span class="line">#path.plugins: /opt/apps/elasticsearch/plugins</span><br><span class="line"># 设置默认索引分片个数，默认为5片。</span><br><span class="line"># index.number_of_shards: 3</span><br><span class="line"># 设置默认索引副本个数，默认为1个副本。</span><br><span class="line"># index.number_of_replicas: 2</span><br><span class="line"># ----------------------------------- Memory -----------------------------------</span><br><span class="line"># Lock the memory on startup:</span><br><span class="line"># 设置为true来锁住内存 因为当jvm开始swapping时es的效率会降低，所以要保证它不swap</span><br><span class="line">bootstrap.memory_lock: true</span><br><span class="line">bootstrap.system_call_filter: false</span><br><span class="line"># ---------------------------------- Network -----------------------------------</span><br><span class="line"># 绑定的ip地址，本机ip 不写是localhost Set the bind address to a specific IP (IPv4 or</span><br><span class="line">IPv6):</span><br><span class="line"># network.host: 192.168.0.1</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">#设置参与集群的端口</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line"># 端口号 默认是9200 Set a custom port for HTTP:</span><br><span class="line">http.port: 9200</span><br><span class="line"># 设置内容的最大容量，默认100mb</span><br><span class="line">http.max_content_length: 100mb</span><br><span class="line"># --------------------------------- Discovery ----------------------------------</span><br><span class="line"># 单播发现的地址Pass an initial list of hosts to perform discovery when new node is</span><br><span class="line">started:</span><br><span class="line"># The default list of hosts is [&quot;127.0.0.1&quot;, &quot;[::1]&quot;] 通过配置这个参数来防止集群脑裂现象</span><br><span class="line">(集群总节点数量/2)+1</span><br><span class="line"># 最小master节点选举数 Prevent the &quot;split brain&quot; by configuring the majority of nodes</span><br><span class="line">(total number of master-eligible nodes / 2 + 1):</span><br><span class="line">discovery.zen.ping_timeout: 30s</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br><span class="line">discovery.zen.fd.ping_timeout: 30s</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;192.168.10.135:9300&quot;, &quot;192.168.10.136:9300&quot;,</span><br><span class="line">&quot;192.168.10.137:9300&quot;]</span><br><span class="line"># discovery.zen.ping.multicast.enabled: false</span><br><span class="line"># ---------------------------------- Gateway -----------------------------------</span><br><span class="line"># 最多等待5分钟，5分钟还没上线 就重新rebalance</span><br><span class="line"># 足够的节点上线后，才进行shard recovery的过程</span><br><span class="line"># 节点最少数量</span><br><span class="line">gateway.recover_after_time: 5m</span><br><span class="line">gateway.recover_after_nodes: 3</span><br><span class="line">gateway.expected_nodes: 3</span><br><span class="line"># ---------------------------------- Various -----------------------------------</span><br><span class="line"># 禁止在生产环境中删除所有索引 Require explicit names when deleting indices:</span><br><span class="line"># 设置是否可以通过正则或者_all删除或者关闭索引库，默认true表示必须需要显式指定索引库名称</span><br><span class="line"># 生产环境建议设置为true，删除索引库的时候必须显式指定，否则可能会误删索引库中的索引库。</span><br><span class="line">action.destructive_requires_name: true</span><br><span class="line"># ---------------------------------- http.cors ---------------------------------</span><br><span class="line"># 运行带cookie访问-用于head插件</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure></p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="true">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        <li title="0" data-url="http://img.027cgb.com/613363/%E5%8B%BF%E6%89%B0%E6%97%A7%E4%BA%BAHy%20-%20%E6%8A%96%E9%9F%B3%E9%98%BF%E6%82%A0%E6%82%A0-%E4%B8%80%E6%9B%B2%E7%9B%B8%E6%80%9D%EF%BC%88%E5%AE%8C%E6%95%B4SQ%E7%89%88%EF%BC%89.mp3"></li>
                    
                        <li title="1" data-url="https://isujin.com/wp-content/uploads/2016/01/%E8%A1%97%E9%81%93%E7%9A%84%E5%AF%82%E5%AF%9E.mp3?_=1"></li>
                    
                        <li title="2" data-url="http://img.027cgb.com/613363/%E6%9E%97%E4%BF%8A%E6%9D%B0%20-%20%E6%88%91%E6%80%80%E5%BF%B5%E7%9A%84%20(Live).mp3"></li>
                    
                        <li title="3" data-url="http://img.027cgb.com/613363/%E6%AF%9B%E4%B8%8D%E6%98%93%20-%20%E7%89%A7%E9%A9%AC%E5%9F%8E%E5%B8%82.mp3"></li>
                    
                        <li title="4" data-url="http://img.027cgb.com/613363/%E6%AF%9B%E4%B8%8D%E6%98%93%20-%20%E5%83%8F%E6%88%91%E8%BF%99%E6%A0%B7%E7%9A%84%E4%BA%BA%20(Live).mp3"></li>
                    
                        <li title="5" data-url="http://img.027cgb.com/613363/%E8%AE%B8%E5%B5%A9%20-%20%E6%9C%89%E4%BD%95%E4%B8%8D%E5%8F%AF.mp3"></li>
                    
                        <li title="6" data-url="http://img.027cgb.com/613363/%E6%9E%97%E4%BF%8A%E6%9D%B0%20-%20%E5%A5%B9%E8%AF%B4.mp3"></li>
                    
                </ul>
            
        </div>
        
    <div id="gitalk-container" class="comment link" data-ae="false" data-ci="" data-cs="" data-r="" data-o="" data-a="" data-d="false">查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>